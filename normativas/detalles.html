<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Normativa | Limacity</title>
  <meta name="description" content="Detalle de la normativa del servidor."/>
  <style>
    :root{--bg1:#0b0c0e; --bg2:#0f1113; --ink:#e8eaf0; --muted:#9aa0b0; --accent:#6ea0ff; --radius:16px}
    body{margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    .container{max-width:900px;margin:36px auto;padding:0 20px}
    .card{background:var(--bg2);border-radius:var(--radius);padding:26px;box-shadow:0 12px 40px rgba(0,0,0,.55)}
    .back{display:inline-block;margin-bottom:16px;color:var(--accent);text-decoration:none;font-weight:600}
    h1{margin:0 0 8px}
    .meta{color:var(--muted);font-size:14px;margin-bottom:18px}
    .content p{line-height:1.7}
    .content h2,.content h3{margin-top:18px}
    .content ul{padding-left:20px}
    .content code, .content pre{background:#121418;border-radius:8px;padding:6px 8px}
  </style>
</head>
<body>
  <div class="container">
    <a class="back" href="/normativas/">← Volver a Normativas</a>
    <article class="card">
      <h1 id="title">Cargando…</h1>
      <div id="meta" class="meta"></div>
      <div id="body" class="content"></div>
    </article>
  </div>

  <script>
    const DATA_URL = '/content/normativas.json';

    function qs(k){return new URLSearchParams(location.search).get(k)}
    function fmtDate(d){try{return new Date(d).toLocaleDateString('es-PE')}catch{return d}}

    // Mini parser markdown→HTML (básico). Para algo más completo, puedes cargar marked.js.
    function mdToHtml(md){
      if(!md) return '';
      let html = md
        .replace(/^### (.*$)/gmi,'<h3>$1</h3>')
        .replace(/^## (.*$)/gmi,'<h2>$1</h2>')
        .replace(/^# (.*$)/gmi,'<h1>$1</h1>')
        .replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')
        .replace(/\*(.*?)\*/g,'<em>$1</em>')
        .replace(/`([^`]+)`/g,'<code>$1</code>')
        .replace(/\n\- (.*)/g,'<ul><li>$1</li></ul>')
        .replace(/\n{2,}/g,'</p><p>');
      html = `<p>${html}</p>`;
      html = html.replace(/<\/ul>\s*<ul>/g,''); // unir ULs consecutivos
      return html;
    }

    async function init(){
      const slug = qs('slug');
      const titleEl = document.getElementById('title');
      const metaEl  = document.getElementById('meta');
      const bodyEl  = document.getElementById('body');

      if(!slug){
        titleEl.textContent = 'Normativa no especificada';
        bodyEl.innerHTML = '<p>Falta el parámetro <code>?slug=</code>.</p>';
        return;
      }

      try{
        const r = await fetch(DATA_URL, {cache:'no-store'});
        const data = await r.json();
        const items = data.items || [];
        const it = items.find(x => x.slug === slug);

        if(!it){
          titleEl.textContent = 'Normativa no encontrada';
          bodyEl.innerHTML = '<p>Verifica el enlace o regresa al listado.</p>';
          return;
        }

        titleEl.textContent = it.title;
        metaEl.textContent = `${fmtDate(it.date)} • ${it.category || ''}`;

        // si el body ya viene en HTML del CMS, respétalo; si parece markdown, conviértelo
        const looksLikeHtml = /<\/?[a-z][\s\S]*>/i.test(it.body||'');
        bodyEl.innerHTML = looksLikeHtml ? (it.body||'') : mdToHtml(it.body||'');

        // Actualizar <title> para SEO
        document.title = `${it.title} | Normativas | Limacity`;
      }catch(err){
        console.error(err);
        titleEl.textContent = 'Error cargando contenido';
        bodyEl.innerHTML = '<p>Intenta nuevamente en unos minutos.</p>';
      }

      // subir arriba al cargar
      scrollTo({top:0,behavior:'instant'});
    }

    init();
  </script>
</body>
</html>

