<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>LimaCityRP Panel</title>
  </head>
  <body>
    <a href="/"
       style="
         position:fixed;
         right:16px; bottom:16px;
         z-index:2147483647;
         background:#1f2937;
         color:#fff;
         padding:10px 14px;
         border-radius:10px;
         text-decoration:none;
         font-weight:700;
         box-shadow:0 6px 16px rgba(0,0,0,.25);
       ">
      ← Volver al sitio
    </a>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js" defer></script>
    <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js" defer></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        if (window.netlifyIdentity) {
          // Si cierras sesión desde el panel, vuelve a la página principal
          window.netlifyIdentity.on("logout", () => {
            location.href = "/";
          });
        }
      });
    </script>
    <script>
  (function () {
    // Espera a que Netlify Identity inicie
    document.addEventListener('DOMContentLoaded', function () {
      function hidePublishForNonEditors() {
        try {
          const u = window.netlifyIdentity && window.netlifyIdentity.currentUser();
          const roles = (u && u.app_metadata && u.app_metadata.roles) || [];
          const isAdminOrEditor = roles.includes('admin') || roles.includes('editor');

          if (!isAdminOrEditor) {
            // Oculta botones de Publish/Quick publish en la toolbar
            const style = document.createElement('style');
            style.innerHTML = `
              [data-testid="editor-toolbar"] [data-testid="publish-button"],
              [data-testid="editor-toolbar"] [data-testid="deploy-preview-button"],
              [class*="PublishButton"],
              [class*="UnpublishedEntryPublishControl"] {
                display: none !important;
              }
            `;
            document.head.appendChild(style);
          }
        } catch (e) { /* no-op */ }
      }

      // Cuando identity cambie de estado (login/logout)
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on('init', hidePublishForNonEditors);
        window.netlifyIdentity.on('login', hidePublishForNonEditors);
      }
      // Fallback por si identity tarda
      setTimeout(hidePublishForNonEditors, 1500);
    });
  })();
</script>

  </body>
</html>






